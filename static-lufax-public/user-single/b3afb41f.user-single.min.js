function checkboxAndradioShow(a){$(a).each(function(){$(this).find("a").length>0||($(this).prepend("<a></a>"),checkboxHandler(this,"init"),radioHandler(this,"init"))})}function checkboxHandler(a,b){var c={check_el:$(a).find("a"),init:b||""};return $(a).hasClass("disabled")?void $(this).unbind("click"):void(c.init.length>0||c.check_el.hasClass("checked")?c.check_el.removeClass("checked").next(":checkbox").prop("checked",!1):c.check_el.addClass("checked").next(":checkbox").prop("checked",!0))}function radioHandler(a,b){var c={check_el:$(a).find("a"),init:b||""};return $(a).hasClass("disabled")?void $(this).unbind("click"):void(c.init.length>0?c.check_el.removeClass("checked").next(":radio").prop("checked",!1):c.check_el.addClass("checked").next(":radio").prop("checked",!0).parent().siblings(".form_radio").find("a").removeClass("checked").next(":radio").prop("checked",!1))}function selectShow(){$(".form_select").each(function(){var a="";if(a=$(this).find($(this).hasClass("show_last")?0==$(this).find("option:[isDefault]").length?"option:last":"option:[isDefault]":$(this).find("option:selected").length>0?"option:selected":"option:first"),$(this).find("a").length>0){if(""==$(this).find("a").text())for($(this).find("a").text(a.text()),i=0;i<$(this).find("option").length;i++)$(this).find("ul").append("<li><a href='javascript:void(0)' title='"+$(this).find("option").eq(i).text()+"'>"+$(this).find("option").eq(i).text()+"</a></li>")}else for($(this).prepend($(this).hasClass("ullh")?"<div><a class='selected-display' data-value="+a.val()+">"+a.text()+"</a></div><ul></ul>":"<div><span><a class='selected-display' data-value="+a.val()+">"+a.text()+"</a></span></div><ul></ul>"),i=0;i<$(this).find("option").length;i++){var b=$(this).find("option").eq(i).val(),c=$(this).find("option").eq(i).text();$(this).find("ul").append("<li><a href='javascript:void(0)' title="+c+" data-value="+b+">"+c+"</a></li>")}$(this).hasClass("ullh")?$(this).find("ul").css({left:3,width:$(this).children("div").outerWidth()-8}):$(this).find("ul").width($(this).width()-2)})}function disabled(){$(".form_checkbox").each(function(){$(this).hasClass("disabled")&&$(this).find("input").attr("disabled","disabld")})}function checked(a){if(checked.options=$.extend({},checked.options,a||{}),checked.options.isRadio===!0)var b=$(".form_radio");else var b=$(".form_checkbox");b.each(function(){$(this).hasClass("checked")&&$(this).find("a").addClass("checked").next("input").prop("checked",!0)})}function radio_disabled(){$(".form_radio").each(function(){$(this).hasClass("disabled")&&$(this).find("a").removeClass().next(":radio").attr({disabled:"disabled"}).prop("checked",!1)})}checked.options={isRadio:!1},$(function(){$(".form_text").not(".pwd,.cal").each(function(){var a=$(this);$(this).find("input").width(a.width()-a.find(".icon").width()-a.find(".last").width()-10)}),$(".form_textarea").each(function(){$(this).find("textarea").width($(this).width()-6).height($(this).height()-6)}).find("textarea").focus(function(){$(this).parents(".form_textarea").addClass("form_textarea_focus")}).blur(function(){$(this).parents(".form_textarea").removeClass("form_textarea_focus")}),$(".form_text").find(":text,:password").focus(function(){$(this).parents(".form_text").addClass("text_focus")}).blur(function(){$(this).parents(".form_text").removeClass("text_focus")}),$(".prompting .leftarrow,.prompting .greyarrow").each(function(){$(this).find(".left_border").height($(this).height()-$(this).find(".left_top_corner").height()-$(this).find(".left_bottom_corner").height()).children("span").height($(this).find(".left_border").height()),$(this).find(".right_border").height($(this).height()-$(this).find(".right_top_corner").height()-$(this).find(".right_bottom_corner").height()).children("span").height($(this).find(".right_border").height()),$(this).find(".prompting_main").height($(this).hasClass("leftarrow")?$(this).height()-2:$(this).height())}),$(".prompting .leftarrowgold").each(function(){$(this).find(".left_border").height($(this).height()-$(this).find(".left_top_corner").height()-$(this).find(".left_bottom_corner").height()).children("span").height($(this).find(".left_border").height()),$(this).find(".right_border").height($(this).height()-$(this).find(".right_top_corner").height()-$(this).find(".right_bottom_corner").height()).children("span").height($(this).find(".right_border").height()),$(this).find(".prompting_main").height($(this).hasClass("leftarrowgold")?$(this).height()-2:$(this).height())}),$(".prompting .toprightarrow,.prompting .topleftarrow").each(function(){$(this).find(".top_center").width($(this).width()-$(this).find(".top_left_corner").width()-$(this).find(".top_right_corner").width()),$(this).find(".bottom_center").width($(this).width()-$(this).find(".bottom_left_corner").width()-$(this).find(".bottom_right_corner").width())}),$(".form_search").find(":text").focus(function(){$(this).parents(".form_search").addClass("focus")}).blur(function(){$(this).parents(".form_search").removeClass("focus")}),$(".form_checkbox").live("click",function(){checkboxHandler(this)}),$(".form_radio").live("click",function(){radioHandler(this)});$(".form_select>div,.form_select>span").live("click",function(){var a=$(this);a.next("ul").toggle(),$(".form_select").css({"z-index":0}),a.parent(".form_select").css({"z-index":1}),a.parent().addClass("focus-form"),a.next("ul").find("li").each(function(){a.find("a").attr("data-value")==a.find("a").attr("data-value")&&a.find("a").addClass("select")})}),$(".form_select>ul>li").live("click",function(){$(this).parent().next().children("option").eq($(this).parent().children("li").index($(this))).prop("selected",!0);var a=$(this).parent().prev().find("a");a.text($(this).text()),a.attr("data-value",$(this).find("a").attr("data-value")),$(this).each(function(){$(this).parent().find("a").removeClass("select")}),$(this).find("a").addClass("select"),$(this).parent("ul").hide()}),$(document).click(function(a){var b=$(a.target).parents(".form_select");$(".form_select").not(b).removeClass("focus-form").find("ul").hide()}),$(".inputs , .textareas, .input-wrap .input , .input-wrap .textarea").live({focus:function(){$(this).parent().addClass("focus-form")},blur:function(){$(this).parent().removeClass("focus-form")}}),selectShow(),checkboxAndradioShow(".form_checkbox"),checkboxAndradioShow(".form_radio"),checked(),checked({isRadio:!0}),disabled(),radio_disabled()}),function(a){a.fn.otpModule=function(b){return this.each(function(){var c={otpType:"1",dynamicType:"1",otpUserMobile:null,otpOfficialCall:null,otpVoiceWaitTime:null,otpCountDownSeconds:null,otpRequestMethod:"GET",otpRequestUrl:null,otpVoiceRequestUrl:null,otpRequestParams:{},otpVoiceRequestParams:{},otpTrigger:!1,otpTriggerCountDown:!1,otpScene:null,otpInputName:"otp",otpMobileType:null,otpRequestCallback:function(){return!1},otpInputTabIndex:null,otpGetRequestParams:function(){return{}},otpGetMobileNo:function(){return k.otpUserMobile},otpFocus:null,otpClick:function(){return!0},otpBlur:null,otpDisablePopupError:!1},d='<div class="control-group otp-group"><label id="otp-label" class="control-label"></label><div class="controls"><span class="input-wrap icon-wrap validate-input"><i class="input-icon validate">&nbsp;</i><input type="text" class="inputs phoneValideNum otp-input"></span>&nbsp;&nbsp;<a href="javascript:void(0);" class="btns btn-info" id="obtainBtn"></a><span class="otp-countdown hidden"></span><span class="errorPanel"><b class="arrow left"> </b><span class="errorContent"></span></span><div class="otp-error-for-popup hidden"></div><div class="otp-info hidden"></div></div></div>';a(this).append(d);var e=a(this).find("#obtainBtn"),f=a(this).find(".otp-info"),g=a(this).find(".otp-countdown"),h=a(this).find(".control-label"),i=(a(this).find(".otp-error-for-popup"),a("body"),a(this).find(".otp-input")),j=a(this).find("#otp-label"),k=a.extend(c,b);"2"==k.otpType?(h.text("手机令牌码："),e.hide()):(h.text("手机动态码："),"1"==k.dynamicType||"2"==k.dynamicType?(e.text("短信获取"),g.html('<span id="sec"></span>秒后重发短信')):"3"==k.dynamicType?(e.text("语音获取"),g.html('<span id="sec"></span>秒后重新获取')):e.hide()),i.attr("name",k.otpInputName),i.attr("id",k.otpInputName),j.attr("for",k.otpInputName),k.otpInputTabIndex&&i.attr("tabindex",k.otpInputTabIndex);var l=function(){e.show(),g.hide(),v||f.hide()},m=function(a){LufaxPopup.popup({popupTitleName:"提示",message:"由于您的动态码获取次数超过限制，您的手机将在"+(a?a.lockHours:"")+"小时内无法获取动态码信息",button:'<a class="btns btn_info confirmBtn" href="javascript:void(0);">确认</a>',iconClass:"minusCircleIcon",onConfirm:function(){n(),o()},onClose:function(){n(),o()}})},n=function(){e.addClass("disabled"),e.prop("disabled",!0)},o=function(){i.prop("disabled",!0),i.val("")},p=function(b,c){var d=a(b).closest(".control-group");d.find(".input-wrap").addClass("error"),"popup"==k.otpScene?(d.find(".otp-error-for-popup").show(),d.find(".otp-error-for-popup").html(c)):(d.find(".errorPanel").css("display","inline-block"),d.find(".errorContent").html(c))},q=function(b){var c=a(b).closest(".control-group");c.find(".input-wrap").removeClass("error"),c.find(".errorPanel").hide(),c.find(".otp-error-for-popup").hide()},r=function(){var b=k.otpRequestUrl,c=k.otpRequestParams;"3"==k.dynamicType&&(b=k.otpVoiceRequestUrl?k.otpVoiceRequestUrl:b,c=k.otpVoiceRequestParams?k.otpVoiceRequestParams:c),a.extend(c,k.otpGetRequestParams()),"GET"==k.otpRequestMethod?a.get(b,c,s):a.post(b,c,s)},s=function(a){"000"===a.retCode?t():"018"===a.retCode?"popup"==k.otpScene?(otp.showErrorMsgForPopup("1",a.retCode,a.retMap),otp.disableOtp(a.retMap)):(otp.showErrorMsg("1",a.retCode,a.retMap),otp.disableOtp(a.retMap)):"021"===a.retCode&&(k.otpDisablePopupError?("popup"==k.otpScene?otp.showErrorMsgForPopup("1",a.retCode,a.retMap):otp.showErrorMsg("1",a.retCode,a.retMap),otp.disableSendOTPBtn(),otp.disableOtpInput()):(m(a.retMap),otp.disableOtp(a.retMap))),"function"==typeof k.otpRequestCallback&&k.otpRequestCallback(a)},t=function(){e.hide(),g.css("display","inline-block"),"2"==k.dynamicType?f.html("动态码已发送至您的手机"+k.otpGetMobileNo()+"，请注意查收"):"3"==k.dynamicType?f.html("您的手机"+k.otpGetMobileNo()+"将在"+k.otpVoiceWaitTime+"内收到<br/><span>"+k.otpOfficialCall+"</span> 的电话，请接听"):"1"==k.dynamicType&&("1"==k.otpMobileType?(f.html("动态码已发送至您的手机"+k.otpGetMobileNo()+'，请在120秒内输入，收不到短信请 <a href="javascript:void(0);" id="voiceObtainBtn">语音获取</a>'),a("body").off("click","#voiceObtainBtn"),a("body").on("click","#voiceObtainBtn",u)):f.html("动态码已发送至您的手机"+k.otpGetMobileNo()+"，请在120秒内输入")),f.show(),tool.countDown.options.countDownSeconds>0?tool.countDown.options.countDownSeconds=parseInt(k.otpCountDownSeconds):tool.countDown({countDownSeconds:parseInt(k.otpCountDownSeconds),secondsOnly:!0,callback:l})},u=function(){if(k.otpClick&&k.otpClick()){q(this);var b=k.otpRequestUrl,c=k.otpRequestParams;b=k.otpVoiceRequestUrl?k.otpVoiceRequestUrl:b,c=k.otpVoiceRequestParams?k.otpVoiceRequestParams:c,a.extend(c,k.otpGetRequestParams()),"GET"==k.otpRequestMethod?a.get(b,c,w):a.post(b,c,w)}},v=!1,w=function(a){"000"===a.retCode?(t(),f.html("您的手机"+k.otpGetMobileNo()+"将在"+k.otpVoiceWaitTime+"内收到<span>"+k.otpOfficialCall+"</span>的电话，请接听"),v=!0,setTimeout(function(){v=!0,f.hide()},1e4)):"018"===a.retCode?"popup"==k.otpScene?(otp.showErrorMsgForPopup("1",a.retCode,a.retMap),otp.disableOtp(a.retMap)):(otp.showErrorMsg("1",a.retCode,a.retMap),otp.disableOtp(a.retMap)):"021"===a.retCode&&(k.otpDisablePopupError?("popup"==k.otpScene?otp.showErrorMsgForPopup("1",a.retCode,a.retMap):otp.showErrorMsg("1",a.retCode,a.retMap),otp.disableSendOTPBtn(),otp.disableOtpInput()):(m(a.retMap),otp.disableOtp(a.retMap))),"function"==typeof k.otpRequestCallback&&k.otpRequestCallback(a)};a("body").off("click","#obtainBtn"),a("body").on("click","#obtainBtn",function(){k.otpClick&&k.otpClick()&&(r(),q(this))}),a(this).find(".otp-input").blur(function(){var b;b="2"==k.otpType?/^[0-9]{6}$/:/^[0-9]{7}$/;var c=a(this).val().length;0===c?p(this,"请填写"):b.test(a(this).val())?q(this):"2"==k.otpType?p(this,"令牌码为6位数字"):p(this,"动态码为7位数字"),k.otpBlur&&k.otpBlur()}),a(this).find(".otp-input").focus(function(){q(this),k.otpFocus&&k.otpFocus()}),k.otpTrigger===!0&&"2"!=k.otpType&&e.trigger("click"),k.otpTrigger===!1&&1==k.otpTriggerCountDown&&"2"!=k.otpType&&t()})}}(jQuery),function(a){var b;window.otp=b={},b.errorCode={1:{"011":"动态码错误或过期","012":"动态码错误或过期","009":"系统异常","018":"由于您输错:errorTimes次动态码，已被锁定，请等待:lockSeconds秒","010":"由于您输错:errorTimes次动态码，已被锁定，请等待:lockSeconds秒","014":"动态码错误或过期","021":"由于您的动态码获取次数超过限制，您的手机将在:lockHours小时内无法获取动态码信息"},2:{"01":["令牌码错误","令牌码错误，请确认您设备上的手机令牌显示的归属用户名与您的用户名是否一致"],"02":"由于您:period内输错:maxFailCount次动态码，已被锁定，请等待:lockTime","03":"您已关闭手机令牌，请重新开始操作流程"}},b.getValue=function(){var b=a(".otp-input").val();return b},b.showPlainErrorMsg=function(b){var c=a(".otp-group");c.find(".input-wrap").addClass("error"),!b||b.length<=0||(c.find(".errorPanel").css("display","inline-block"),c.find(".errorContent").html(b),b.length>20?c.find(".errorPanel").addClass("multipleLine"):c.find(".errorPanel").removeClass("multipleLine"))},b.showPlainErrorMsgForPopup=function(b){var c=a(".otp-group");c.find(".input-wrap").addClass("error"),!b||b.length<=0||(c.find(".otp-error-for-popup").show(),c.find(".otp-error-for-popup").html(b),b.length>20?c.find(".errorPanel").addClass("multipleLine"):c.find(".errorPanel").removeClass("multipleLine"))},b.showErrorMsg=function(c,d,e){var f=a(".otp-group"),g=b.parseErrorCode(c,d,e);f.find(".input-wrap").addClass("error"),!g||g.length<=0||(f.find(".errorPanel").css("display","inline-block"),f.find(".errorContent").html(g),g.length>20?f.find(".errorPanel").addClass("multipleLine"):f.find(".errorPanel").removeClass("multipleLine"))},b.showErrorMsgForPopup=function(c,d,e){var f=a(".otp-group"),g=b.parseErrorCode(c,d,e);f.find(".input-wrap").addClass("error"),!g||g.length<=0||(f.find(".otp-error-for-popup").show(),f.find(".otp-error-for-popup").html(g),g.length>20?f.find(".errorPanel").addClass("multipleLine"):f.find(".errorPanel").removeClass("multipleLine"))},b.clearErrorMsg=function(){var b=a(".otp-group");b.find(".input-wrap").removeClass("error"),b.find(".errorPanel").hide(),b.find(".otp-error-for-popup").hide()},b.formatErrorMsg=function(a,b){var c=[];for(var d in b)a.indexOf(d)>=0&&c.push(d+"="+b[d]);var e=a.replace(/:(\w+)/g,function(a,c){var d=b[c];return d?d:c});return e},b.parseErrorCode=function(a,c,d){var e;if("2"==a)if("01"==c)e=!d.failCount||d.failCount<3?b.errorCode[a][c][0]:b.errorCode[a][c][1];else{if("03"==c)return b.tokenErrorPopup(d),e;"02"==c?(b.disableOtp(d),e=b.errorCode[a][c]):e=b.errorCode[a][c]}else("018"==c||"010"==c)&&b.disableOtp(d),e=b.errorCode[a][c];return e=e?b.formatErrorMsg(e,d):c},b.tokenErrorPopup=function(){LufaxPopup.popup({popupTitleName:"提示",message:"您已关闭手机令牌，请重新开始操作流程",button:'<a class="btns btn_info confirmBtn" href="javascript:void(0);">确认</a>',iconClass:"minusCircleIcon",onConfirm:function(){window.location.reload()},onClose:function(){window.location.reload()}})},b.disableSendOTPBtn=function(){a("#obtainBtn").addClass("disabled"),a("#voiceObtainBtn").addClass("disabled"),a("#obtainBtn").prop("disabled",!0),a("#voiceObtainBtn").prop("disabled",!0),tool.countDown.options.countDownSeconds=0},b.disableOtpInput=function(){a(".otp-input").prop("disabled",!0),a(".otp-input").val(""),a(".otp-group").find(".input-wrap").removeClass("error")},b.enableSendOTPBtn=function(){a("#obtainBtn").removeClass("disabled"),a("#obtainBtn").removeProp("disabled"),a("#voiceObtainBtn").removeClass("disabled"),a("#voiceObtainBtn").removeProp("disabled")},b.enableOtpInput=function(){a(".otp-input").prop("disabled",!1)},b.disableOtp=function(a){var c=a.lockSeconds;b.disableSendOTPBtn(),b.disableOtpInput(),setTimeout(function(){b.enableSendOTPBtn(),b.enableOtpInput(),b.clearErrorMsg()},1e3*c)},b.checkOtp=function(a,c,d){var e;e="2"==a?/^[0-9]{6}$/:/^[0-9]{7}$/;var f=c?c.length:0,g=!1,h="";return 0===f?h="请填写":e.test(c)?(g=!0,b.clearErrorMsg()):h="2"==a?"令牌码为6位数字":"动态码为7位数字",g||("popup"==d?b.showPlainErrorMsgForPopup(h):b.showPlainErrorMsg(h)),g}}(jQuery);