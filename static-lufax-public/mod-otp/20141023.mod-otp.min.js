!function(a){a.fn.otpModule=function(b){return this.each(function(){var c={otpType:"1",dynamicType:"1",otpUserMobile:null,otpOfficialCall:null,otpVoiceWaitTime:null,otpCountDownSeconds:null,otpRequestMethod:"GET",otpRequestUrl:null,otpVoiceRequestUrl:null,otpRequestParams:{},otpVoiceRequestParams:{},otpTrigger:!1,otpTriggerCountDown:!1,otpScene:null,otpInputName:"otp",otpRequestCallback:function(){return!1},otpInputTabIndex:null,otpGetRequestParams:function(){return{}},otpGetMobileNo:function(){return k.otpUserMobile},otpFocus:null,otpClick:function(){return!0},otpBlur:null,otpDisablePopupError:!1},d='<div class="control-group otp-group"><label id="otp-label" class="control-label"></label><div class="controls"><span class="input-wrap icon-wrap validate-input"><i class="input-icon validate">&nbsp;</i><input type="text" class="inputs phoneValideNum otp-input"></span>&nbsp;&nbsp;<a href="javascript:void(0);" class="btns btn-info" id="obtainBtn"></a><span class="otp-countdown hidden"></span><span class="errorPanel"><b class="arrow left"> </b><span class="errorContent"></span></span><div class="otp-error-for-popup hidden"></div><div class="otp-info hidden"></div></div></div>';a(this).append(d);var e=a(this).find("#obtainBtn"),f=a(this).find(".otp-info"),g=a(this).find(".otp-countdown"),h=a(this).find(".control-label"),i=(a(this).find(".otp-error-for-popup"),a("body"),a(this).find(".otp-input")),j=a(this).find("#otp-label"),k=a.extend(c,b);"2"==k.otpType?(h.text("手机令牌码："),e.hide()):(h.text("手机动态码："),"1"==k.dynamicType||"2"==k.dynamicType?(e.text("短信获取"),g.html('<span id="sec"></span>秒后重发短信')):"3"==k.dynamicType?(e.text("语音获取"),g.html('<span id="sec"></span>秒后重新获取')):e.hide()),i.attr("name",k.otpInputName),i.attr("id",k.otpInputName),j.attr("for",k.otpInputName),k.otpInputTabIndex&&i.attr("tabindex",k.otpInputTabIndex);var l=function(){e.show(),g.hide(),v||f.hide()},m=function(a){LufaxPopup.popup({popupTitleName:"提示",message:"由于您的动态码获取次数超过限制，您的手机将在"+(a?a.lockHours:"")+"小时内无法获取动态码信息",button:'<a class="btns btn_info confirmBtn" href="javascript:void(0);">确认</a>',iconClass:"minusCircleIcon",onConfirm:function(){n(),o()},onClose:function(){n(),o()}})},n=function(){e.addClass("disabled"),e.prop("disabled",!0)},o=function(){i.prop("disabled",!0),i.val("")},p=function(b,c){var d=a(b).closest(".control-group");d.find(".input-wrap").addClass("error"),"popup"==k.otpScene?(d.find(".otp-error-for-popup").show(),d.find(".otp-error-for-popup").html(c)):(d.find(".errorPanel").css("display","inline-block"),d.find(".errorContent").html(c))},q=function(b){var c=a(b).closest(".control-group");c.find(".input-wrap").removeClass("error"),c.find(".errorPanel").hide(),c.find(".otp-error-for-popup").hide()},r=function(){var b=k.otpRequestUrl,c=k.otpRequestParams;"3"==k.dynamicType&&(b=k.otpVoiceRequestUrl?k.otpVoiceRequestUrl:b,c=k.otpVoiceRequestParams?k.otpVoiceRequestParams:c),a.extend(c,k.otpGetRequestParams()),"GET"==k.otpRequestMethod?a.get(b,c,s):a.post(b,c,s)},s=function(a){"000"===a.retCode?t():"018"===a.retCode?"popup"==k.otpScene?(otp.showErrorMsgForPopup("1",a.retCode,a.retMap),otp.disableOtp(a.retMap)):(otp.showErrorMsg("1",a.retCode,a.retMap),otp.disableOtp(a.retMap)):"021"===a.retCode&&(k.otpDisablePopupError?("popup"==k.otpScene?otp.showErrorMsgForPopup("1",a.retCode,a.retMap):otp.showErrorMsg("1",a.retCode,a.retMap),otp.disableSendOTPBtn(),otp.disableOtpInput()):(m(a.retMap),otp.disableOtp(a.retMap))),"function"==typeof k.otpRequestCallback&&k.otpRequestCallback(a)},t=function(){e.hide(),g.css("display","inline-block"),"2"==k.dynamicType?f.html("动态码已发送至您的手机"+k.otpGetMobileNo()+"，请注意查收"):"3"==k.dynamicType?f.html("您的手机"+k.otpGetMobileNo()+"将在"+k.otpVoiceWaitTime+"内收到<br/><span>"+k.otpOfficialCall+"</span> 的电话，请接听"):"1"==k.dynamicType&&(f.html("动态码已发送至您的手机"+k.otpGetMobileNo()+'，收不到短信，请 <a href="javascript:void(0);" id="voiceObtainBtn">语音获取</a>'),a("body").off("click","#voiceObtainBtn"),a("body").on("click","#voiceObtainBtn",u)),f.show(),tool.countDown.options.countDownSeconds>0?tool.countDown.options.countDownSeconds=parseInt(k.otpCountDownSeconds):tool.countDown({countDownSeconds:parseInt(k.otpCountDownSeconds),secondsOnly:!0,callback:l})},u=function(){if(k.otpClick&&k.otpClick()){q(this);var b=k.otpRequestUrl,c=k.otpRequestParams;b=k.otpVoiceRequestUrl?k.otpVoiceRequestUrl:b,c=k.otpVoiceRequestParams?k.otpVoiceRequestParams:c,a.extend(c,k.otpGetRequestParams()),"GET"==k.otpRequestMethod?a.get(b,c,w):a.post(b,c,w)}},v=!1,w=function(a){"000"===a.retCode?(t(),f.html("您的手机"+k.otpGetMobileNo()+"将在"+k.otpVoiceWaitTime+"内收到<span>"+k.otpOfficialCall+"</span>的电话，请接听"),v=!0,setTimeout(function(){v=!0,f.hide()},1e4)):"018"===a.retCode?"popup"==k.otpScene?(otp.showErrorMsgForPopup("1",a.retCode,a.retMap),otp.disableOtp(a.retMap)):(otp.showErrorMsg("1",a.retCode,a.retMap),otp.disableOtp(a.retMap)):"021"===a.retCode&&(k.otpDisablePopupError?("popup"==k.otpScene?otp.showErrorMsgForPopup("1",a.retCode,a.retMap):otp.showErrorMsg("1",a.retCode,a.retMap),otp.disableSendOTPBtn(),otp.disableOtpInput()):(m(a.retMap),otp.disableOtp(a.retMap))),"function"==typeof k.otpRequestCallback&&k.otpRequestCallback(a)};a("body").off("click","#obtainBtn"),a("body").on("click","#obtainBtn",function(){k.otpClick&&k.otpClick()&&(r(),q(this))}),a(this).find(".otp-input").blur(function(){var b;b="2"==k.otpType?/^[0-9]{6}$/:/^[0-9]{7}$/;var c=a(this).val().length;0===c?p(this,"请填写"):b.test(a(this).val())?q(this):"2"==k.otpType?p(this,"令牌码为6位数字"):p(this,"动态码为7位数字"),k.otpBlur&&k.otpBlur()}),a(this).find(".otp-input").focus(function(){q(this),k.otpFocus&&k.otpFocus()}),k.otpTrigger===!0&&"2"!=k.otpType&&e.trigger("click"),k.otpTrigger===!1&&1==k.otpTriggerCountDown&&"2"!=k.otpType&&t()})}}(jQuery),function(a){var b;window.otp=b={},b.errorCode={1:{"011":"动态码错误或过期","012":"动态码错误或过期","009":"系统异常","018":"由于您输错:errorTimes次动态码，已被锁定，请等待:lockSeconds秒","010":"由于您输错:errorTimes次动态码，已被锁定，请等待:lockSeconds秒","014":"动态码错误或过期","021":"由于您的动态码获取次数超过限制，您的手机将在:lockHours小时内无法获取动态码信息"},2:{"01":["令牌码错误","令牌码错误，请确认您设备上的手机令牌显示的归属用户名与您的用户名是否一致"],"02":"由于您:period内输错:maxFailCount次动态码，已被锁定，请等待:lockTime","03":"您已关闭手机令牌，请重新开始操作流程"}},b.getValue=function(){var b=a(".otp-input").val();return b},b.showPlainErrorMsg=function(b){var c=a(".otp-group");c.find(".input-wrap").addClass("error"),!b||b.length<=0||(c.find(".errorPanel").css("display","inline-block"),c.find(".errorContent").html(b),b.length>20?c.find(".errorPanel").addClass("multipleLine"):c.find(".errorPanel").removeClass("multipleLine"))},b.showPlainErrorMsgForPopup=function(b){var c=a(".otp-group");c.find(".input-wrap").addClass("error"),!b||b.length<=0||(c.find(".otp-error-for-popup").show(),c.find(".otp-error-for-popup").html(b),b.length>20?c.find(".errorPanel").addClass("multipleLine"):c.find(".errorPanel").removeClass("multipleLine"))},b.showErrorMsg=function(c,d,e){var f=a(".otp-group"),g=b.parseErrorCode(c,d,e);f.find(".input-wrap").addClass("error"),!g||g.length<=0||(f.find(".errorPanel").css("display","inline-block"),f.find(".errorContent").html(g),g.length>20?f.find(".errorPanel").addClass("multipleLine"):f.find(".errorPanel").removeClass("multipleLine"))},b.showErrorMsgForPopup=function(c,d,e){var f=a(".otp-group"),g=b.parseErrorCode(c,d,e);f.find(".input-wrap").addClass("error"),!g||g.length<=0||(f.find(".otp-error-for-popup").show(),f.find(".otp-error-for-popup").html(g),g.length>20?f.find(".errorPanel").addClass("multipleLine"):f.find(".errorPanel").removeClass("multipleLine"))},b.clearErrorMsg=function(){var b=a(".otp-group");b.find(".input-wrap").removeClass("error"),b.find(".errorPanel").hide(),b.find(".otp-error-for-popup").hide()},b.formatErrorMsg=function(a,b){var c=[];for(var d in b)a.indexOf(d)>=0&&c.push(d+"="+b[d]);var e=a.replace(/:(\w+)/g,function(a,c){var d=b[c];return d?d:c});return e},b.parseErrorCode=function(a,c,d){var e;if("2"==a)if("01"==c)e=!d.failCount||d.failCount<3?b.errorCode[a][c][0]:b.errorCode[a][c][1];else{if("03"==c)return b.tokenErrorPopup(d),e;"02"==c?(b.disableOtp(d),e=b.errorCode[a][c]):e=b.errorCode[a][c]}else("018"==c||"010"==c)&&b.disableOtp(d),e=b.errorCode[a][c];return e=e?b.formatErrorMsg(e,d):c},b.tokenErrorPopup=function(){LufaxPopup.popup({popupTitleName:"提示",message:"您已关闭手机令牌，请重新开始操作流程",button:'<a class="btns btn_info confirmBtn" href="javascript:void(0);">确认</a>',iconClass:"minusCircleIcon",onConfirm:function(){window.location.reload()},onClose:function(){window.location.reload()}})},b.disableSendOTPBtn=function(){a("#obtainBtn").addClass("disabled"),a("#voiceObtainBtn").addClass("disabled"),a("#obtainBtn").prop("disabled",!0),a("#voiceObtainBtn").prop("disabled",!0),tool.countDown.options.countDownSeconds=0},b.disableOtpInput=function(){a(".otp-input").prop("disabled",!0),a(".otp-input").val(""),a(".otp-group").find(".input-wrap").removeClass("error")},b.enableSendOTPBtn=function(){a("#obtainBtn").removeClass("disabled"),a("#obtainBtn").removeProp("disabled"),a("#voiceObtainBtn").removeClass("disabled"),a("#voiceObtainBtn").removeProp("disabled")},b.enableOtpInput=function(){a(".otp-input").prop("disabled",!1)},b.disableOtp=function(a){var c=a.lockSeconds;b.disableSendOTPBtn(),b.disableOtpInput(),setTimeout(function(){b.enableSendOTPBtn(),b.enableOtpInput(),b.clearErrorMsg()},1e3*c)},b.checkOtp=function(a,c,d){var e;e="2"==a?/^[0-9]{6}$/:/^[0-9]{7}$/;var f=c?c.length:0,g=!1,h="";return 0===f?h="请填写":e.test(c)?(g=!0,b.clearErrorMsg()):h="2"==a?"令牌码为6位数字":"动态码为7位数字",g||("popup"==d?b.showPlainErrorMsgForPopup(h):b.showPlainErrorMsg(h)),g}}(jQuery);